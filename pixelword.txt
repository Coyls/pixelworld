background(0, 0, 0);
//-------------------------------- LES MONDES -----------------------------------------
var allWorldsBack = [[[[0,0,0,0,0,0,0,0],// World : 0 0
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0]],
                      
                      [[0,0,0,0,0,0,0,0],// World : 0 1
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0]],
                      
                      [[0,0,0,0,0,0,0,0],// World : 0 2
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0]]
                       
                       ],[
                           
                      [[0,0,0,0,0,0,0,0],// World : 1 0
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0]],
                      
                      [[0,0,0,0,0,0,0,0],// World : 1 1
                       [0,0,0,0,0,0,0,0],
                       [0,0,1,1,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0]],
                      
                      [[0,0,0,0,0,0,0,0],// World : 1 2
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0]]
                       
                       ],[
                           
                      [[0,0,0,0,0,0,0,0],// World : 2 0
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0]],
                      
                      [[0,0,0,0,0,0,0,0],// World : 2 1
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,1,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0]],
                      
                      [[0,0,0,0,0,0,0,0],// World : 2 2
                       [0,1,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0],
                       [0,0,0,0,0,0,0,0]]]];
                      
var allWorldsFront = [[[[0,0,0,0,5,0,0,0],// World : 0 0
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [5,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0]],
                      
                       [[0,0,0,0,5,0,0,0],// World : 0 1
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [5,0,0,0,0,0,0,5],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0]],
                      
                       [[0,0,0,0,5,0,0,0],// World : 0 2
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,5],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0]]
                       
                        ],[
                           
                       [[0,0,0,0,5,0,0,0],// World : 1 0
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [5,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,5,0,0,0]],
                      
                       [[0,0,0,0,5,0,0,0],// World : 1 1
                        [0,0,0,0,0,0,0,0],
                        [0,0,1,1,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [5,0,0,0,0,0,0,5],
                        [0,0,4,0,0,0,0,0],
                        [0,0,0,0,0,0,2,0],
                        [0,0,0,0,5,0,0,0]],
                      
                       [[0,0,0,0,5,0,0,0],// World : 1 2
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,4,0,0,5],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,5,0,0,0]]
                       
                        ],[
                           
                       [[0,0,0,0,0,0,0,0],// World : 2 0
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [5,0,0,0,0,0,0,0],
                        [0,0,0,0,4,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,5,0,0,0]],
                      
                       [[0,0,0,0,0,0,0,0],// World : 2 1
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,7,0,0,0],
                        [5,0,0,0,0,0,0,5],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,5,0,0,0]],
                      
                       [[0,0,0,0,0,0,0,0],// World : 2 2
                        [0,6,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,5],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,0,0,0,0],
                        [0,0,0,0,5,0,0,0]]]];
//------------------------------------------------------------------------------------------

// Context
var screenWidth = width;
var screenHeight = height;

var iWX = 1;
var iWY = 1;
var gameStart = true;

var fontInventory = createFont("fantasy",40);
var fontTitleStartMenu = createFont("fantasy",60);
var fontTextStartMenu = createFont("fantasy",20);

// Front
var xOrigine = 0;
var yOrigine = 0;
var side = screenWidth / allWorldsBack[iWX][iWY].length;

// Hero
var hero = [4, 4];

// inventory
var inventoryOpen = false;

var keyChest = 0;
var blueGem = 0;
var greenGem = 0;

//----------------------------------------------- DrawElement -----------------------------
var drawPath = function(i,j) {
    image(getImage("cute/GrassBlock"),xOrigine+i*(side) ,yOrigine+j*(side) +77 , side, -110);
};
var drawObstacle = function(i,j) {
    image(getImage("cute/Rock"),xOrigine+i*(side) ,yOrigine+j*(side) -28, side ,78);
};
var drawKey = function(i,j) {
    image(getImage("cute/Key"),xOrigine+i*(side) + 5 ,yOrigine+j*(side) -5 ,39,49 );

};
var drawBlueGem = function(i,j) {
    image(getImage("cute/GemBlue"),xOrigine+i*(side) + 5 ,yOrigine+j*(side) -5 ,39,49 );

};
var drawEnd = function(i,j) {
    image(getImage("cute/DoorTallClosed"),xOrigine+i*(side) ,yOrigine+j*(side) - 21, side, 74);};

var drawHero = function(i,j) {
    image(getImage("cute/CharacterBoy"), side * (hero[0]),side * (hero[1]) - 28,46,85);
};

var drawSun = function(i,j) {
    image(getImage("cute/DirtBlock"),xOrigine+i*(side) ,yOrigine+j*(side) -30, side ,102);
};

var drawPnj = function(i,j) {
    image(getImage("cute/CharacterCatGirl"),xOrigine+i*(side) ,yOrigine+j*(side) - 28,46,85);
};
var drawChestClose = function(i,j) {
    image(getImage("cute/ChestClosed"),xOrigine+i*(side) + 5 ,yOrigine+j*(side) -5 ,39,49 );
};
var drawChestOpen = function(i,j) {
    image(getImage("cute/ChestOpen"),xOrigine+i*(side) + 5 ,yOrigine+j*(side) -5 ,39,49 );
};
// --------------------------------------- overlay ---------------------------
var drawInventory = function() {
    var iW = 60;
    var iH = 90;
    var oX = 70;
    var oY = 40;
    
    var dx = 80;
    var dy = 35;
    
    textFont(fontInventory);
    fill(0, 0, 0, 175);
    stroke(255, 255, 255);
    strokeWeight(5);
    rect(side, side, 300, 300, 30);
    fill(255, 255, 255);
    image(getImage("cute/GemBlue"),oX,oY,iW,iH);
    text(":  " + blueGem, iW + dx, iH + dy);
    image(getImage("cute/Key"),oX,oY + dx,iW,iH);
    text(":  " + keyChest, iW + dx, iH + dy*3);
    image(getImage("cute/GemGreen"),oX,oY + dx * 2,iW,iH);
    text(":  " + greenGem, iW + dx, iH + dy*5);
};

var drawPnjText = function() {
    var iW = 60;
    var iH = 90;
    var oX = 80;
    var oY = 81;
    
    var dx = 88;
    var dy = 35;
    
     
    fill(0, 0, 0, 175);
    stroke(255, 255, 255);
    strokeWeight(5);
    rect(side, side, 300, 198, 30);
    fill(255, 255, 255);
    textFont(fontTextStartMenu);
    text("Mysterious seller...", 67,86);
    image(getImage("cute/GemGreen"),oX,oY,iW,iH);
    textFont(fontInventory);
    text("= 3 x", oX + dx,oY + dy *2);
    image(getImage("cute/GemBlue"),oX + dx *2 ,oY,iW,iH);
    textFont(fontTextStartMenu);
    text("press     b     to buy", 126,205);
};


var drawStartMenu = function() {
    fill(0, 0, 0);
    rect(0, 0, width, height);
    fill(255, 255, 255);
    textFont(fontTitleStartMenu);
    text("Pixelworld", 70,150);
    textFont(fontTextStartMenu);
    text("Press espace to start", 123,214);
    textFont(fontTextStartMenu);
    text("z,q,s,d = to move", 140,287);
    text("i = inventory", 150,318);
    text("e = interaction", 141,346);
};

var drawChestText = function() {
    var oX = 80;
    var oY = 66;
    var iW = -36;
    var iH = 88;
    
    var dx = -65;
    var dy = 67;
    
    fill(0, 0, 0, 175);
    stroke(255, 255, 255);
    strokeWeight(5);
    rect(iW + oX, iH + oY, 300, 43, 30);
    fill(255, 255, 255);
    textFont(fontTextStartMenu);
    text("I need a key to open this chest !",side + oX + dx, side + oY + dy);
};



// ----------------------------------- DrawWorld ---------------------------------------
var drawWorld = function() {
for (var j=0;j<allWorldsFront[iWX][iWY].length;j++){
    for (var i=0;i<allWorldsFront[iWX][iWY][j].length;i++){
        // path
        drawPath(i,j);
        // Obstacle
        if (allWorldsFront[iWX][iWY][i][j] === 1) {
        drawObstacle(i,j);
        }
        // key
        if (allWorldsFront[iWX][iWY][i][j] === 2) {
        drawKey(i,j);
        }
        // door
        if (allWorldsFront[iWX][iWY][i][j] === 3) {
        drawEnd(i,j);
        }
        // blueGem
        if (allWorldsFront[iWX][iWY][i][j] === 4) {
        drawBlueGem(i,j);
        }
        // sun
        if (allWorldsFront[iWX][iWY][i][j] === 5) {
        drawSun(i,j);
        }
        // pnj
        if (allWorldsFront[iWX][iWY][i][j] === 6) {
        drawPnj(i,j);
        }
        // chestClose 
        if (allWorldsFront[iWX][iWY][i][j] === 7) {
        drawChestClose(i,j);
        }
        // chestOpen 
        if (allWorldsFront[iWX][iWY][i][j] === 8) {
        drawChestOpen(i,j);
        }
    }

}

};

// ---------------------------------- drawOverlay ----------------------------------------

var drawOverlay = function() {
    // inventory
    if (inventoryOpen === true) {
       drawInventory(); 
    }
    // startMenu
    if (gameStart === true) {
        drawStartMenu();
    }
    // pnjText
    if (allWorldsFront[iWX][iWY][hero[0]][hero[1]-1] === 6) {
        drawPnjText();    
    }
    // chestText 
    if (allWorldsFront[iWX][iWY][hero[0]][hero[1]-1] === 7) {
        drawChestText();    
    }
};

// ------------------- function onGround ----------------------------------------------
var onGroundKey = function () {
    keyChest++;
    allWorldsFront[iWX][iWY][hero[0]][hero[1]] = 0;
};

var onGroundblueGem = function () {
    blueGem++;
    allWorldsFront[iWX][iWY][hero[0]][hero[1]] = 0;
};

// ------------------- function check-ground ----------------------------------------------

var checkGround = function () {
    if (allWorldsFront[iWX][iWY][hero[0]][hero[1]] === 2){
        onGroundKey();
    }
    if (allWorldsFront[iWX][iWY][hero[0]][hero[1]] === 4){
        onGroundblueGem();
    }
};
// ------------------------------------------ Change World -------------------------------
var changeWorld = function () {
    if (allWorldsFront[iWX][iWY][hero[0]][hero[1]] === 5){
        if (hero[1] === 0){
            iWY++;
            hero = [4,6];
        }
        if (hero[1] === 7){
            iWY--;
            hero = [4,1];
        }
        if (hero[0] === 0){
            iWX++;
            hero = [6,4];
        }
        if (hero[0] === 7){
            iWX--;
            hero = [1,4];
        }
    }
};
//--------------------------------------- keyPressed --------------------------------------
keyPressed = function() {
    if (key.toString() === 'z') {
        if ((allWorldsBack[iWX][iWY][hero[0]][hero[1]-1] !== 1) && (hero[1] !== 0)) {
            hero[1] = hero[1]-1;
        }
        
    }
    if (key.toString() === 'q') {
        if (allWorldsBack[iWX][iWY][hero[0]-1][hero[1]] !== 1) {
        hero[0] = hero[0]-1;
        }
        
    }
    if (key.toString() === 's') {
        if ((allWorldsBack[iWX][iWY][hero[0]][hero[1]+1] !== 1) && (hero[1] !== allWorldsBack[iWX][iWY].length -1)){
            hero[1] = hero[1]+1;
        }
        
    }
    if (key.toString() === 'd') {
        if (allWorldsBack[iWX][iWY][hero[0]+1][hero[1]] !== 1) {
        hero[0] = hero[0]+1;
        }
    }
    if (key.toString() === 'i') {
        if (inventoryOpen) {
            inventoryOpen = false;
        } else {
            inventoryOpen = true;
        }
    }
    if (key.toString() === ' ') {
        gameStart = false;
    }
    if (key.toString() === 'b') {
        if (allWorldsFront[iWX][iWY][hero[0]][hero[1]-1] === 6 && blueGem > 2) {
            blueGem = blueGem - 3;
            greenGem++;
        }
        
    }
    // interaction
    if (key.toString() === 'e') {
        if (allWorldsFront[iWX][iWY][hero[0]][hero[1]-1] === 7 && keyChest > 0) {
            allWorldsFront[iWX][iWY][hero[0]][hero[1]-1] = 8;
            blueGem = blueGem + 5;
        }
    }
    
    
};
//-------------------------------- Gestion des touches -------------------------------------



// GENERATE world
var draw = function() {
    drawWorld();
    drawHero();
    checkGround();
    drawOverlay();
    changeWorld();
    
    
    //text(hero, 10, 25);
    //text(iWX, 56, 25);
    //text(iWY, 76, 25);
    //text(allWorldsFront[iWX][iWY][hero[0]][hero[1]-1], 112 ,89);

};

//-------------------------------------------- code utile a conserver
// var randomObstacle = floor(random(0, obstacle.length));
// world Elements
// var obstacle = ["cute/Rock","cute/TreeShort","cute/TreeTall","cute/TreeUgly"];
// image(getImage("cute/TreeTall")


